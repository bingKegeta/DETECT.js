---
import Layout from '../layouts/Layout.astro';

let formData = { username: '', password: '' };

function handleInputChange(e) {
  const { name, value } = e.target;
  formData = { ...formData, [name]: value };
}

async function handleSubmit(event) {
  event.preventDefault();

  try {
    const response = await fetch("http://localhost:5000/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData),
    });

    if (response.ok) {
      const data = await response.json();
      alert(data.message);

      // Redirect to video-graph page on successful login
      window.location.href = "/video-graph";
    } else {
      const errorData = await response.json();
      alert(errorData.message);
    }
  } catch (error) {
    console.error("Error:", error);
    alert("An error occurred while trying to log in.");
  }
}
---

<Layout title="Login">
  <div class="min-h-screen flex items-center justify-center bg-gray-900">
    <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-md p-6">
      <h1 class="text-3xl font-bold text-center mb-6 text-purple-400">Login</h1>
      <form class="space-y-4" onSubmit={handleSubmit}>
        <div>
          <label for="username" class="block text-sm font-medium text-gray-300">Username</label>
          <input
            id="username"
            name="username"
            type="text"
            required
            class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 shadow-sm focus:ring-purple-500 focus:border-purple-500"
            placeholder="Enter your username"
            onInput={handleInputChange}
          />
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-300">Password</label>
          <input
            id="password"
            name="password"
            type="password"
            required
            class="mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 shadow-sm focus:ring-purple-500 focus:border-purple-500"
            placeholder="Enter your password"
            onInput={handleInputChange}
          />
        </div>
        <button
          type="submit"
          class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700"
        >
          Login
        </button>
      </form>
    </div>
  </div>
</Layout>
